module ESnet;

#redef exit_only_after_terminate = T;
# file containing signature
redef signature_files += "cve-2016-4303.sig";

export {
        redef enum Notice::Type += {
                IPerf_CVE_2016_4303,
                IPerf_CVE_2016_4303_EXACT
        };
}

event signature_match(state: signature_state, msg: string, data: string){
        if (/^cve-2016-4303$/ in state$sig_id){
        		print fmt("sig match");
                NOTICE([$note=IPerf_CVE_2016_4303,
       				$conn=state$conn, $msg=fmt("%s possible target of iPerf remote exploit", state$conn$id$resp_h),
       				$identifier=cat(state$conn$id$resp_h)]);
        }
        if (/^cve-2016-4303-poc$/ in state$sig_id){
                print fmt("Signature match EXACT");
                NOTICE([$note=IPerf_CVE_2016_4303_EXACT,
       				$conn=state$conn, $msg=fmt("%s likely target of iPerf remote exploit", state$conn$id$resp_h),
       				$identifier=cat(state$conn$id$resp_h)]);
        }
}
